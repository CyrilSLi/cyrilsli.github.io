<!DOCTYPE html>
<html lang = "en">
<head>
    <title>YouTube Search</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
    <style>
        html, body {
            margin: 0px;
            min-width: 440px;
        }
        #player {
            display: flex;
            flex-direction: column;
        }
        p {
            font-family: Arial, sans-serif;
            font-size: 20px;
            margin: 20px;
        }
        #load {
            margin: 0px 20px 20px;
        }
        a {
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        img {
            margin: 0px 20px;
        }
        h1 {
            font-family: Arial, sans-serif;
            font-size: 36px;
            font-weight: bold;
            margin: 0px 20px
        }
        iframe {
            margin: 0px 20px;
            display: block;
        }
        input, button {
            font-family: Arial, sans-serif;
            font-size: 20px;
            padding: 5px 7px;
            margin: 0px 10px 20px;
        }
        input {
            flex: 1;
            width: 150px;
        }
        form, #vidops {
            margin: 20px 10px 0px;
            display: flex;
        }
        div {
            margin: 0px;
        }
    </style>
</head>
<body onload="brython (0)">
    <script type="text/python">
        from browser import document, ajax, html, window
        from urllib import parse
        def rfind (text, values, end = "}"):
            pointer = 0
            for j in values:
                pointer += text [pointer : ].find (j)
                if pointer == -1:
                    return "N/A"
            return text [pointer + len (values [-1]) + 3 : pointer + text [pointer : ].find (end) - 1].replace ("\\n", "\n").replace ("\\u0026", "&").replace ('\\"', '"')
        player_url = document.query.getvalue ("player_url")
        if not player_url:
            player_url = "https://www.youtube-nocookie.com/embed/%v?rel=0&playlist=%v&loop=1&modestbranding=1"
        cors_url = document.query.getvalue ("cors_url")
        if not cors_url:
            cors_url = "https://corsproxy.io/?"
        player_persist = False if document.query.getvalue ("player_persist") else True
        def complete (res):
            if not player_persist:
                remove_video ()
            del document ["load"]
            if "frame" in document and "vidops" not in document:
                add_vidops ()
            for i in res.text.split ("videoRenderer") [1 : ]:
                document ["results"] <= html.A (html.P (rfind (i, ["title", "text"])), tabindex = "0", href = f'javascript:req_video ("{player_url.replace ("%v", rfind (i, ["videoId"], ","))}")')
                channel, user_url = rfind (i, ["ownerText", "text"], ","), rfind (i, ["webCommandMetadata", "url"], ",")
                if channel != "N/A":
                    document ["results"] <= html.A (html.P (f"{channel} ({user_url [1 : ]})"), tabindex = "0", href = f'javascript:req_user ("{user_url}", "{channel}")')
                document ["results"] <= html.P (f'Length: {rfind (i, ["lengthText", "simpleText"])}')
                views = rfind (i, ["viewCountText", "simpleText"]) [ : -6]
                if (not set (views) <= set ("0123456789,")) or (not views):
                    views = "N/A"
                document ["results"] <= html.P (f'Views: {views}')
                document ["results"] <= html.P (f'Date: {rfind (i, ["publishedTimeText", "simpleText"])}')
                document ["results"] <= html.A (html.IMG ("", src = f'https://i.ytimg.com/vi/{rfind (i, ["videoId"], ",")}/hqdefault.jpg', width = "400px"), tabindex = "-1", href = f'javascript:req_video ("{player_url.replace ("%v", rfind (i, ["videoId"], ","))}")')
            document ["results"] <= html.DIV (style = "height: 20px;")
        def req_search (event, homepage = False):
            document ["results"].clear ()
            search = document ["search"].value
            if homepage:
                document ["results"] <= html.H1 ("Homepage")
                ajax.get (cors_url + "https://www.youtube.com/?app=desktop&persist_app=1", oncomplete = complete)
            else:
                document ["results"] <= html.H1 (f'Results for "{search}"')
                ajax.get (cors_url + "https://www.youtube.com/results?app=desktop&persist_app=1&search_query=" + parse.quote (search).replace (" ", "+") + "&sp=EgIQAQ%253D%253D", oncomplete = complete)
            document ["player"] <= html.P ("Loading...", id = "load")
            window.scrollTo (0, 0)
        def req_user (url, name):
            document ["results"].clear ()
            document ["results"] <= (html.H1 (f'Videos by "{name}" ({url [1 : ]})'))
            document ["player"] <= html.P ("Loading...", id = "load")
            window.scrollTo (0, 0)
            ajax.get (cors_url + "https://www.youtube.com" + url + "/videos?app=desktop&persist_app=1", oncomplete = complete)
        def req_video (url):
            remove_video (False)
            document ["player"] <= html.P ("Loading...", id = "load")
            window.scrollTo (0, 0)
            if player_persist and "frame" in document:
                document ["frame"].id = "player_old"
            document ["player"] <= html.IFRAME (src = url, flex = "1", height = "0px", id = "frame", frameBorder = "0", allowfullscreen = "allowfullscreen", onload = "reload_frame ();")
        def reload_frame ():
            document ["frame"].onload = ""
            document ["frame"].src += ""
            del document ["load"]
            if "player_old" in document:
                del document ["player_old"]
            document ["player"].attrs ["style"] = "height: 100vh; height: 100dvh;"
            document ["frame"].attrs ["height"] = "100%"
            document ["frame"].attrs ["style"] = ""
            if "vidops" not in document:
                add_vidops ()
        def remove_video (frame = True):
            if "frame" in document and frame:
                del document ["frame"]
                document ["player"].attrs ["style"] = ""
            if "vidops" in document:
                del document ["vidops"]
                document ["frame"].attrs ["style"] = "margin: 0px 20px 20px;"
        def hide_show ():
            if document ["frame"].attrs ["height"] == "0px":
                document ["frame"].attrs ["height"] = "100%"
                document ["vidops"].attrs ["style"] = "margin: 20px 10px 0px;"
                document ["player"].attrs ["style"] = "height: 100vh; height: 100dvh;"
            else:
                document ["frame"].attrs ["height"] = "0px"
                document ["vidops"].attrs ["style"] = "margin: 0px 10px;"
                document ["player"].attrs ["style"] = ""
        def add_vidops ():
            document ["frame"].attrs ["style"] = ""
            document ["player"] <= html.DIV (id = "vidops")
            document ["vidops"] <= html.BUTTON ("Close player", style = "flex: 1;", onclick = "remove_video ();")
            document ["vidops"] <= html.BUTTON ("Hide / Show", style = "flex: 1;", onclick = "hide_show ();")
        window.req_search = req_search
        window.req_user = req_user
        window.req_video = req_video
        window.reload_frame = reload_frame
        window.remove_video = remove_video
        window.hide_show = hide_show
        document ["request"].bind ("submit", req_search)
        document ["request"] <= html.BUTTON ("Home", type = "reset", onclick = "req_search (null, true);")
        document ["request"] <= html.INPUT (type = "text", id = "search", placeholder = "Search YouTube", autofocus = "autofocus")
        document ["request"] <= html.BUTTON ("Search", type = "submit")
        req_search (None, True)
    </script>
    <div id = "player">
        <form action = javascript:void(0); id = "request"></form>
    </div>
    <div id = "results"><p id = "load">Starting Brython... (JavaScript required)</p></div>
</body>
</html>
